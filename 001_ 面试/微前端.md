#### 微前端

- 微前端架构是一种将 web 应用程序开发为小型前端应用程序的方法
- 整体应用是由小型应用组合而成的，每个小型应用都是独立的，独立开发、独立部署

- 优势：
  - 独立开发、独立部署、快速交付
  - 技术选型更广泛
  - 应用之间高度解耦，不会相互影响

#### 如何设计微前端

- 特点：

  - 单一职责 --> 每个小应用，负责比较独立的功能模块
  - 通讯和数据交互的通用接口
  - 外观一致

- 解决方案
  - nginx 路由转发
    - 简单、快速
    - 切换应用时会触发浏览器刷新，影响体验
  - iframe 嵌套
    - 实现简单，子应用互不影响，通过 postMessage 通信
    - 有兼容性问题
  - web components
    - 每个子应用有独立的 script 和 css，也可以单独部署
    - 通信复杂，改造成本高
  - 组合式应用路由分发
    - 纯前端改造，体验好，无感切换
  - qiankun --> 比较成熟

#### 微前端组成

- 主应用 --> 一个前端 SPA 项目，主要负责应用注册、路由映射、消息下发等
- 子应用 --> 广泛的技术选型都可以，注册到主应用中，由主应用进行管理，也能独立部署访问

#### 微前端 -- 主应用相关问题

- 路由分发
  - 主应用需要拉取微应用的页面内容，涉及到远程拉取机制
  - 远程拉取机制采用 fetch API 方式获取到微应用的 html 内容，然后通过解析将微应用的 js 和 css 抽离
  - 采用 eval 方式运行 js, 将 css 和 html 内容 append 到微应用的展示区域
  - 当微应用切走时，同步卸载这些内容
- 主微应用隔离问题
  - css 隔离：主微同屏渲染，css 会相互污染。那么采用 css module 或命名空间的方式，给每个微应用添加特定前缀，就不会干扰
  - js 隔离：全局变量会感染，那么采用沙箱机制，让局部的 js 运行时，对外部变量的访问和修改处于可控范围
- 通信问题
  - 需要通信的问题，都告诉给主应用，主应用再派发给多个子应用
  - 主应用定义事件中心 Event, 每个微应用分别来注册事件，当事件触发时，再由事件中心统一分发

#### single-spa 核心原理： https://www.cnblogs.com/synY/p/13958963.html

- question:

  - 怎么通过 single-spa 去拉取子应用的 js
  - single-spa 是怎么访问子应用的生命周期函数的
  - 主应用是怎么传 props 给子应用的生命周期函数的
  - 主应用怎么控制路由

- registerApplication 函数 --> 规范化参数，合并应用，执行 reroute 方法

  ```
    singleSpa.registerApplication({ // 注册微前端服务
        name,
        app: () => {},
        activeMenu: () => location.pathname.startsWith('xxx') // 配置微前端模块
    })
  ```

- reroute(), 负责改变 app.status, 和执行在子应用中注册的生命周期函数

#### qiankun 核心原理：
